<!DOCTYPE html>
<html>
<head>
    <title>MNIST Model Comparison</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>MNIST CNN Model Comparison</h1>
        
        <div class="model-config">
            <div class="model-form">
                <h2>Model 1 Configuration</h2>
                <div class="input-group">
                    <label>Kernel Sizes:</label>
                    <input type="number" id="m1k1" placeholder="Kernel 1 (e.g., 16)" value="16">
                    <input type="number" id="m1k2" placeholder="Kernel 2 (e.g., 32)" value="32">
                    <input type="number" id="m1k3" placeholder="Kernel 3 (e.g., 64)" value="64">
                    <input type="number" id="m1k4" placeholder="Kernel 4 (e.g., 32)" value="32">
                </div>
                <div class="input-group">
                    <label>Optimizer:</label>
                    <select id="m1optimizer">
                        <option value="adam">Adam</option>
                        <option value="sgd">SGD</option>
                    </select>
                    <label>Learning Rate:</label>
                    <input type="number" id="m1lr" value="0.001" step="0.0001" min="0.0001" max="0.1">
                </div>
                <button onclick="startTraining('model1')">Train Model 1</button>
                <div class="status-indicator">
                    Status: <span id="m1-status" class="status idle">Idle</span>
                </div>
            </div>
            
            <div class="model-form">
                <h2>Model 2 Configuration</h2>
                <div class="input-group">
                    <label>Kernel Sizes:</label>
                    <input type="number" id="m2k1" placeholder="Kernel 1 (e.g., 8)" value="8">
                    <input type="number" id="m2k2" placeholder="Kernel 2 (e.g., 8)" value="8">
                    <input type="number" id="m2k3" placeholder="Kernel 3 (e.g., 8)" value="8">
                    <input type="number" id="m2k4" placeholder="Kernel 4 (e.g., 8)" value="8">
                </div>
                <div class="input-group">
                    <label>Optimizer:</label>
                    <select id="m2optimizer">
                        <option value="adam">Adam</option>
                        <option value="sgd">SGD</option>
                    </select>
                    <label>Learning Rate:</label>
                    <input type="number" id="m2lr" value="0.001" step="0.0001" min="0.0001" max="0.1">
                </div>
                <button onclick="startTraining('model2')">Train Model 2</button>
                <div class="status-indicator">
                    Status: <span id="m2-status" class="status idle">Idle</span>
                </div>
            </div>
        </div>

        <div id="loss-plot"></div>
        <div id="accuracy-plot"></div>
    </div>

    <script>
        function getModelConfig(modelId) {
            const prefix = modelId === 'model1' ? 'm1' : 'm2';
            return {
                kernel_config: [
                    parseInt(document.getElementById(prefix + 'k1').value),
                    parseInt(document.getElementById(prefix + 'k2').value),
                    parseInt(document.getElementById(prefix + 'k3').value),
                    parseInt(document.getElementById(prefix + 'k4').value)
                ],
                optimizer: document.getElementById(prefix + 'optimizer').value,
                learning_rate: parseFloat(document.getElementById(prefix + 'lr').value)
            };
        }

        function startTraining(modelId) {
            const config = getModelConfig(modelId);
            fetch('/start_training', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model_id: modelId,
                    config: config
                }),
            });
        }

        function updatePlots() {
            fetch('/data')
                .then(response => response.json())
                .then(data => {
                    const traces = [];
                    
                    // Add traces for both models
                    ['model1', 'model2'].forEach((modelId, idx) => {
                        const history = data.histories[modelId];
                        const config = data.configs[modelId];
                        
                        if (history.epochs.length > 0 && config) {
                            const configStr = `${config.optimizer}, lr=${config.learning_rate}, kernels=[${config.kernel_config}]`;
                            traces.push({
                                x: history.epochs,
                                y: history.losses,
                                mode: 'lines',
                                name: `${modelId} Loss (${configStr})`
                            });
                        }
                    });

                    const accTraces = [];
                    ['model1', 'model2'].forEach((modelId, idx) => {
                        const history = data.histories[modelId];
                        const config = data.configs[modelId];
                        
                        if (history.epochs.length > 0 && config) {
                            const configStr = `${config.optimizer}, lr=${config.learning_rate}, kernels=[${config.kernel_config}]`;
                            accTraces.push({
                                x: history.epochs,
                                y: history.train_accuracies,
                                mode: 'lines+markers',
                                name: `${modelId} Train (${configStr})`,
                                line: { width: 2 },
                                marker: { size: 6 }
                            });
                            
                            accTraces.push({
                                x: history.epochs,
                                y: history.val_accuracies,
                                mode: 'lines+markers',
                                name: `${modelId} Val (${configStr})`,
                                line: { dash: 'dot', width: 2 },
                                marker: { size: 6 }
                            });
                        }
                    });

                    Plotly.newPlot('loss-plot', traces, {
                        title: 'Training Loss Comparison',
                        xaxis: { title: 'Epoch' },
                        yaxis: { title: 'Loss' },
                        margin: { t: 40 }
                    });

                    Plotly.newPlot('accuracy-plot', accTraces, {
                        title: 'Model Accuracy Comparison',
                        xaxis: { title: 'Epoch' },
                        yaxis: { 
                            title: 'Accuracy (%)',
                            range: [90, 100],
                            dtick: 1
                        },
                        margin: { t: 40 },
                        showlegend: true,
                        legend: {
                            x: 0,
                            y: 1,
                            xanchor: 'left',
                            yanchor: 'top'
                        }
                    });
                })
                .catch(error => console.error('Error:', error));
        }

        // Add this function to update status indicators
        function updateStatus() {
            fetch('/status')
                .then(response => response.json())
                .then(data => {
                    ['model1', 'model2'].forEach(modelId => {
                        const prefix = modelId === 'model1' ? 'm1' : 'm2';
                        const statusElement = document.getElementById(`${prefix}-status`);
                        const status = data[modelId];
                        
                        // Update status class and text
                        statusElement.className = `status ${status}`;
                        statusElement.textContent = status.charAt(0).toUpperCase() + 
                                                 status.slice(1);
                        
                        // Update button state
                        const button = document.querySelector(`button[onclick="startTraining('${modelId}')"]`);
                        button.disabled = status === 'running';
                    });
                })
                .catch(error => console.error('Error:', error));
        }

        // Add status update to your interval
        setInterval(() => {
            updatePlots();
            updateStatus();
        }, 2000);
    </script>
</body>
</html> 